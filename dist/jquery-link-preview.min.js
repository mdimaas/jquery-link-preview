!function(t){function r(r,e){return t.extend({},t.defaultOptions,r,{url:i(e),redirectUrl:this.toRedirectUrl?this.toRedirectUrl+"?"+this.toRedirectParam+"="+this.url:this.url})}function i(t){var r=/(https?:\/\/[^\s]+)/g;return t.match(r)}function e(r,i){var e=!1;return t.each(r.children(),function(){var r=t(this).attr("data-loaded-link");r&&r.indexOf(i)>-1&&(e=!0)}),e}function n(r,i){var e=t("<div/>").append(r),n=a(e,"title"),l=a(e,"url");return{title:n?n:e.find("title").text(),description:a(e,"description"),pageLink:l?l:i,imageLink:a(e,"image")}}function a(r,i){return t(r.find("meta[property$='"+i+"']").get(0)).attr("content")}function l(r,i,e){var n=t("<div class='link-preview' data-loaded-link='"+i+"'/>");n.append(u(e,r.attr("data-image-width")));var a=t("<div class='link-preview-description'/>");a.append("<a href='"+e.pageLink+"' target='_blank'>"+e.title+"</a>").append(c(e)),n.append(a),d(n,r.attr("data-image-width")),r.html(n)}function u(r,i,e){if(r&&r.imageLink){var n=t("<img src='"+r.imageLink+"' />");return d(n,i),n}return null}function d(t,r){r&&t.width(r)}function c(r){return r&&r.description?t("<p>"+(r.description.length>100?r.description.substring(0,100)+"...":r.description)+"</p>"):null}t.fn.linkPreview=function(r){var i=this;if(!e(i,r.url)){this.html(r.ajaxLoader);var a={};r.urlWrapper&&(a[r.urlWrapperParam]=String(r.url)),t.get(r.urlWrapper?r.urlWrapper:r.url,a,function(t){t&&("function"==typeof callback?callback(t):l(i,r.url,n(t,r.redirectUrl)))})}},t.defaultOptions={url:"",urlWrapper:null,urlWrapperParam:"url",ajaxLoader:"loading...",toRedirectUrl:null,toRedirectParam:null,redirectUrl:null},t.fn.linkDetect=function(i){var e=r(i,this.text());if(e.url){var n=t("<div/>");this.after(n),e.width&&n.attr("data-image-width",e.width),n.linkPreview(e)}}}(jQuery);