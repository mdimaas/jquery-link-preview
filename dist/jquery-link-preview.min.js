!function(r){function t(t,i){return r.extend({},r.defaultOptions,a(i),t,{url:e(i.text()),redirectUrl:this.toRedirectUrl?this.toRedirectUrl+"?"+this.toRedirectParam+"="+this.url:this.url})}function a(r){return{url:r.attr("data-url"),urlWrapper:r.attr("data-url-wrapper"),urlWrapperParam:r.attr("data-url-wrapper-param"),ajaxLoader:r.attr("data-ajax-loader"),toRedirectUrl:r.attr("data-to-redirect-url"),toRedirectParam:r.attr("data-to-redirect-url")}}function e(r){var t=/(https?:\/\/[^\s]+)/g;return r.match(t)}function i(t,a){var e=!1;return r.each(t.children(),function(){var t=r(this).attr("data-loaded-link");t&&t.indexOf(a)>-1&&(e=!0)}),e}function n(t,a){var e=r("<div/>").append(t),i=l(e,"title"),n=l(e,"url");return{title:i?i:e.find("title").text(),description:l(e,"description"),pageLink:n?n:a,imageLink:l(e,"image")}}function l(t,a){return r(t.find("meta[property$='"+a+"']").get(0)).attr("content")}function d(t,a,e){var i=r("<div class='link-preview' data-loaded-link='"+a+"'/>");i.append(u(e,t.attr("data-image-width")));var n=r("<div class='link-preview-description'/>");n.append("<a href='"+e.pageLink+"' target='_blank'>"+e.title+"</a>").append(c(e)),i.append(n),p(i,t.attr("data-image-width")),t.html(i)}function u(t,a,e){if(t&&t.imageLink){var i=r("<img src='"+t.imageLink+"' />");return p(i,a),i}return null}function p(r,t){t&&r.width(t)}function c(t){return t&&t.description?r("<p>"+(t.description.length>100?t.description.substring(0,100)+"...":t.description)+"</p>"):null}r.fn.linkPreview=function(t){var a=this;if(!i(a,t.url)){this.html(t.ajaxLoader);var e={};t.urlWrapper&&(e[t.urlWrapperParam]=String(t.url)),r.get(t.urlWrapper?t.urlWrapper:t.url,e,function(r){r&&("function"==typeof t.callback?t.callback(r):d(a,t.url,n(r,t.redirectUrl)))})}},r.defaultOptions={url:"",urlWrapper:null,urlWrapperParam:"url",ajaxLoader:"loading...",toRedirectUrl:null,toRedirectParam:"away",redirectUrl:null},r.fn.linkDetect=function(a){var e=t(a,this);if(e.url){var i=r("<div/>");this.after(i),e.width&&i.attr("data-image-width",e.width),i.linkPreview(e)}}}(jQuery);